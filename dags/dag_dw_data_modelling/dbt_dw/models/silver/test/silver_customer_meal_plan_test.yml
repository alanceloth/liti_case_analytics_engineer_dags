version: 2
models:
  - name: silver_customer_meal_plan
    description: "Cleaned and validated customer meal plan data"
    tests:
      # Teste de unicidade e não nulo para o campo customerMealPlanId
      - unique:
          column_name: customerMealPlanId

      - not_null:
          column_name: customerMealPlanId

      # Teste de integridade referencial para customerId
      - relationships:
          column_name: customerId
          to: ref('silver_customer')
          field: CustomerId

      # Teste de integridade referencial para mealPlanId
      - relationships:
          column_name: mealPlanId
          to: ref('silver_meal_plans')
          field: mealPlanId

      # Teste de valores permitidos para datas (startDate <= endDate ou endDate IS NULL)
      - expression_is_true:
          expression: "startDate <= endDate OR endDate IS NULL"

      # Teste de consistência para campos não nulos de startDate e createdAt
      - not_null:
          column_name: startDate

      - not_null:
          column_name: createdAt

      # Teste de valores booleanos para as restrições alimentares
      - accepted_values:
          column_name: restrictions_gluten
          values: [true, false]

      - accepted_values:
          column_name: restrictions_lactose
          values: [true, false]

      - accepted_values:
          column_name: restrictions_vegan
          values: [true, false]

      - accepted_values:
          column_name: restrictions_ovolacto
          values: [true, false]

      - accepted_values:
          column_name: restrictions_highFodMaps
          values: [true, false]
