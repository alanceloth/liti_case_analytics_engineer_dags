version: 2
models:
  - name: silver_customer_objectives
    description: "Cleaned and validated customer objectives data"
    tests:
      # Teste de unicidade e não nulo para o campo customerObjectiveId
      - unique:
          column_name: customerObjectiveId

      - not_null:
          column_name: customerObjectiveId

      # Teste de integridade referencial para customerId
      - relationships:
          column_name: customerId
          to: ref('silver_customer')
          field: CustomerId

      # Teste de integridade referencial para objectiveId
      - relationships:
          column_name: objectiveId
          to: ref('silver_customer_objectives')
          field: objectiveId

      # Teste de valores permitidos para datas (startDate <= data atual)
      - expression_is_true:
          expression: "startDate <= CURRENT_DATETIME()"

      # Teste de consistência para campos não nulos de createdAt e updatedAt
      - not_null:
          column_name: createdAt

      - not_null:
          column_name: updatedAt
